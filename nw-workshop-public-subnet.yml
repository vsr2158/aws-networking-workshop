AWSTemplateFormatVersion: "2010-09-09"
Description: "This template deploys a VPC, with a public subnet. It deploys an Internet Gateway, with a default route on the public subnet. It deploys an EC2 instance in the public subnet to serve as a bastion host"
Parameters:
  ChildSubnetCIDR:
    Description: Subnet_CIDR
    Type: String
  VPC:
    Description: VPC_ID
    Type: String
  InternetGateway:
    Description: IGW_ID
    Type: String
Resources:
  PublicSubnet:
    Type: AWS::EC2::Subnet
    Properties:
      #AvailabilityZone: !Select [0, !GetAZs AWS::Region]
      CidrBlock: !Ref ChildSubnetCIDR
      MapPublicIpOnLaunch: true
      VpcId: !Ref VPC
  PublicRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref VPC
  DefaultPublicRoute:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref PublicRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway
  PublicSubnetRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref PublicRouteTable
      SubnetId: !Ref PublicSubnet
